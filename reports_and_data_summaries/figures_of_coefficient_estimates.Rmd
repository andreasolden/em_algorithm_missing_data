---
title: "Plotting coefficients"
author: "Andreas Olden"
date: "January 30, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}

#Initiate project
library(checkpoint) #Checkpoint assures us that we use the same package versions
checkpoint("2019-01-21") #As they were at the date set in this function. i.e "2019-01-21"
library(here) # allows us to use relative file paths, see readme or simulations doc
library(tidyverse) # Tidyverse data wrangling tool to use pipe-operator
library(knitr)
```

### One variable case

####Sim 1: One variable, alfa(-1.8,-1.5), beta(-0.02), xmeans(0), xsd(12.3)

```{r, echo=FALSE, message=FALSE}

        readRDS( here("results", "simres1.rds") ) %>%
        select(EMb1, BIb1) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        ggplot(., aes(x=estimate, linetype=coefficient)) + 
                geom_freqpoly()  +
                geom_vline(data =  readRDS( here("results", "simres1.rds") ), 
                           aes(xintercept = mean(Beta1)) )

```

####Sim 2: One variable, alfa(-3.0,-1.5), beta(-0.02), xmeans(0), xsd(12.3)
Increase alfa-deviation

```{r, echo=FALSE, message=FALSE}

        readRDS( here("results", "simres2.rds") ) %>%
        select(EMb1, BIb1) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        ggplot(., aes(x=estimate, linetype=coefficient)) + 
                geom_freqpoly()  +
                geom_vline(data =  readRDS( here("results", "simres1.rds") ), 
                           aes(xintercept = mean(Beta1)) )

```

####Sim 3: One variable, alfa(-1.8,-1.5), beta(-0.02), xmeans(0), xsd(123)
Ten times the standard deviation in x

```{r, echo=FALSE, message=FALSE}

        readRDS( here("results", "simres3.rds") ) %>%
        select(EMb1, BIb1) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        ggplot(., aes(x=estimate, linetype=coefficient)) + 
                geom_freqpoly()  +
                geom_vline(data =  readRDS( here("results", "simres1.rds") ), 
                           aes(xintercept = mean(Beta1)) )
```


### Two variable case

####Sim 4: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(12.3, 1.8), corr(0)

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres4.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```


####Sim 5: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(12.3, 1.8), corr(0.5)
Add correlation

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres5.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```

####Sim 6: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(12.3, 1.8), corr(0.9)
Add even more correlation

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres6.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```

####Sim 7: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(123, 1.8), corr(0.0)
Increase x1 standard deviations by 10

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres7.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```


####Sim 8: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(123, 18), corr(0.0)
Increase standard deviations by 10

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres8.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```

####Sim 9: alfa(-1.8,-1.5), beta(-0.02, 0.2), xmeans(0), xsd(123, 18), corr(0.9)
Increase standard deviations by 10 and correlation to 0.9

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2"), vl = c(-0.02, 0.2))

 readRDS( here("results", "simres9.rds") ) %>%
        select(EMb1, EMb2, BIb1, BIb2) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="EMb2"), 'EM', 'BI')),
                coeff_type = as.factor(ifelse(
                        (coefficient=="EMb1" | coefficient=="BIb1"), 'b1', 'b2'))
                )    %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```

####Sim 10: alfa(-1.8,-1.5), beta(0.023, -0.005, -0.200), xmeans(38.0, 14.2, 1.4), xsd(12.3, 9.1, 1.8), corr(1, 0.4 ,0.6, 0.4, 1, 0.5,0.6, 0.5, 1)

```{r, echo=FALSE, message=FALSE}
#Add true value under vl, update file
trueval <- data.frame(coeff_type = c("b1", "b2", "b3"), vl = c(0.023, -0.005, -0.200))

 readRDS( here("results", "simres10.rds") ) %>%
        select(EMb1, EMb2, EMb3, BIb1, BIb2, BIb3) %>%
        gather(coefficient, estimate, factor_key = TRUE) %>%
        mutate(
                est_type = as.factor(ifelse(
                (coefficient=="EMb1" | coefficient=="EMb2" | coefficient=="EMb3"), 'EM', 'BI')),
                
                coeff_type = as.factor(
                        ifelse((coefficient=="EMb1" | coefficient=="BIb1"), "b1", 
                               ifelse((coefficient=="EMb2" | coefficient=="BIb2"), "b2", "b3") )
                )
                ) %>%    
        ggplot(aes(x=estimate, linetype=est_type)) + 
                        geom_freqpoly() +
                facet_grid(cols = vars(coeff_type), scales = "free_x") +
                geom_vline(aes(xintercept=vl), data=trueval)
```